from cmp.automata import State
from cmp.parsing import Lexer
from cmp.regex import NFA


class CoolLexer(Lexer):
    def __init__(self, G):
        self.G = G
        self.eof = G.EOF
        self.regexs = self._build_regexs(self.__table())
        self.automaton = self._build_automaton()

    def __table(self):
        G = self.G
        return [
            (G["+"], NFA(2, [0], {(1, "+"): [0], }, start=1)),
            (G["-"], NFA(2, [0], {(1, "-"): [0], }, start=1)),
            (G["*"], NFA(2, [1], {(0, "*"): [1], }, start=0)),
            (G["/"], NFA(2, [1], {(0, "/"): [1], }, start=0)),
            (G["<="], NFA(3, [0], {(1, "<"): [2], (2, "="): [0], }, start=1)),
            (G["<"], NFA(2, [1], {(0, "<"): [1], }, start=0)),
            (G["="], NFA(2, [0], {(1, "="): [0], }, start=1)),
            (G["~"], NFA(2, [0], {(1, "~"): [0], }, start=1)),
            (G["not"], NFA(4, [2], {(1, "n"): [3], (3, "o"): [0], (0, "t"): [2], }, start=1)),
            (G["{"], NFA(2, [1], {(0, "{"): [1], }, start=0)),
            (G["}"], NFA(2, [0], {(1, "}"): [0], }, start=1)),
            (G["("], NFA(2, [1], {(0, "("): [1], }, start=0)),
            (G[")"], NFA(2, [1], {(0, ")"): [1], }, start=0)),
            (G[","], NFA(2, [1], {(0, ","): [1], }, start=0)),
            (G["."], NFA(2, [0], {(1, "."): [0], }, start=1)),
            (G["@"], NFA(2, [0], {(1, "@"): [0], }, start=1)),
            (G[":"], NFA(2, [1], {(0, ":"): [1], }, start=0)),
            (G[";"], NFA(2, [0], {(1, ";"): [0], }, start=1)),
            (G["<-"], NFA(3, [2], {(0, "<"): [1], (1, "-"): [2], }, start=0)),
            (G["=>"], NFA(3, [0], {(1, "="): [2], (2, ">"): [0], }, start=1)),
            (G["class"], NFA(6, [2], {(5, "c"): [0], (0, "l"): [1], (1, "a"): [4], (4, "s"): [3], (3, "s"): [2], }, start=5)),
            (G["inherits"], NFA(9, [7], {(0, "i"): [1], (1, "n"): [2], (2, "h"): [4], (4, "e"): [5], (5, "r"): [6], (6, "i"): [8], (8, "t"): [3], (3, "s"): [7], }, start=0)),
            (G["if"], NFA(3, [0], {(2, "i"): [1], (1, "f"): [0], }, start=2)),
            (G["then"], NFA(5, [4], {(3, "t"): [2], (2, "h"): [1], (1, "e"): [0], (0, "n"): [4], }, start=3)),
            (G["else"], NFA(5, [2], {(3, "e"): [4], (4, "l"): [0], (0, "s"): [1], (1, "e"): [2], }, start=3)),
            (G["fi"], NFA(3, [2], {(0, "f"): [1], (1, "i"): [2], }, start=0)),
            (G["while"], NFA(6, [1], {(2, "w"): [3], (3, "h"): [4], (4, "i"): [5], (5, "l"): [0], (0, "e"): [1], }, start=2)),
            (G["loop"], NFA(5, [4], {(0, "l"): [1], (1, "o"): [2], (2, "o"): [3], (3, "p"): [4], }, start=0)),
            (G["pool"], NFA(5, [2], {(3, "p"): [4], (4, "o"): [0], (0, "o"): [1], (1, "l"): [2], }, start=3)),
            (G["let"], NFA(4, [1], {(0, "l"): [2], (2, "e"): [3], (3, "t"): [1], }, start=0)),
            (G["in"], NFA(3, [2], {(1, "i"): [0], (0, "n"): [2], }, start=1)),
            (G["case"], NFA(5, [4], {(0, "c"): [1], (1, "a"): [2], (2, "s"): [3], (3, "e"): [4], }, start=0)),
            (G["esac"], NFA(5, [3], {(4, "e"): [1], (1, "s"): [0], (0, "a"): [2], (2, "c"): [3], }, start=4)),
            (G["of"], NFA(3, [0], {(1, "o"): [2], (2, "f"): [0], }, start=1)),
            (G["new"], NFA(4, [1], {(3, "n"): [2], (2, "e"): [0], (0, "w"): [1], }, start=3)),
            (G["isvoid"], NFA(7, [2], {(4, "i"): [6], (6, "s"): [5], (5, "v"): [3], (3, "o"): [1], (1, "i"): [0], (0, "d"): [2], }, start=4)),
            (G["true"], NFA(5, [4], {(0, "t"): [1], (1, "r"): [2], (2, "u"): [3], (3, "e"): [4], }, start=0)),
            (G["false"], NFA(6, [2], {(0, "f"): [1], (1, "a"): [5], (5, "l"): [3], (3, "s"): [4], (4, "e"): [2], }, start=0)),
            (G["end"], NFA(4, [2], {(1, "e"): [3], (3, "n"): [0], (0, "d"): [2], }, start=1)),
            (G["space"], NFA(2, [0], {(1, " "): [0], (0, " "): [0], }, start=1)),
            (G["newline"], NFA(2, [1], {(0, "\n"): [1], (1, "\n"): [1], }, start=0)),
            (G["tab"], NFA(2, [0], {(1, "\t"): [0], (0, "\t"): [0], }, start=1)),
            (G["integer"], NFA(3, [0], {(1, "4"): [0], (1, "5"): [0], (1, "3"): [0], (1, "8"): [0], (1, "9"): [0], (1, "1"): [0], (1, "-"): [2], (1, "6"): [0], (1, "2"): [0], (1, "7"): [0], (0, "4"): [0], (0, "5"): [0], (0, "0"): [0], (0, "3"): [0], (0, "8"): [0], (0, "9"): [0], (0, "1"): [0], (0, "6"): [0], (0, "2"): [0], (0, "7"): [0], (2, "4"): [0], (2, "5"): [0], (2, "3"): [0], (2, "8"): [0], (2, "9"): [0], (2, "1"): [0], (2, "6"): [0], (2, "2"): [0], (2, "7"): [0], }, start=1)),
            (G["type"], NFA(2, [0], {(1, "G"): [0], (1, "A"): [0], (1, "Z"): [0], (1, "C"): [0], (1, "H"): [0], (1, "B"): [0], (1, "N"): [0], (1, "J"): [0], (1, "O"): [0], (1, "Y"): [0], (1, "R"): [0], (1, "L"): [0], (1, "M"): [0], (1, "S"): [0], (1, "V"): [0], (1, "K"): [0], (1, "P"): [0], (1, "U"): [0], (1, "F"): [0], (1, "X"): [0], (1, "T"): [0], (1, "E"): [0], (1, "I"): [0], (1, "Q"): [0], (1, "D"): [0], (1, "W"): [0], (0, "G"): [0], (0, "A"): [0], (0, "Z"): [0], (0, "3"): [0], (0, "C"): [0], (0, "d"): [0], (0, "k"): [0], (0, "9"): [0], (0, "H"): [0], (0, "o"): [0], (0, "1"): [0], (0, "g"): [0], (0, "u"): [0], (0, "B"): [0], (0, "7"): [0], (0, "p"): [0], (0, "i"): [0], (0, "t"): [0], (0, "4"): [0], (0, "N"): [0], (0, "j"): [0], (0, "J"): [0], (0, "c"): [0], (0, "O"): [0], (0, "Y"): [0], (0, "s"): [0], (0, "w"): [0], (0, "R"): [0], (0, "2"): [0], (0, "r"): [0], (0, "L"): [0], (0, "M"): [0], (0, "S"): [0], (0, "V"): [0], (0, "e"): [0], (0, "h"): [0], (0, "n"): [0], (0, "a"): [0], (0, "0"): [0], (0, "8"): [0], (0, "K"): [0], (0, "P"): [0], (0, "6"): [0], (0, "U"): [0], (0, "F"): [0], (0, "f"): [0], (0, "X"): [0], (0, "T"): [0], (0, "l"): [0], (0, "z"): [0], (0, "E"): [0], (0, "5"): [0], (0, "I"): [0], (0, "Q"): [0], (0, "D"): [0], (0, "b"): [0], (0, "y"): [0], (0, "v"): [0], (0, "m"): [0], (0, "q"): [0], (0, "x"): [0], (0, "W"): [0], }, start=1)),
            (G["id"], NFA(2, [1], {(0, "d"): [1], (0, "k"): [1], (0, "o"): [1], (0, "g"): [1], (0, "u"): [1], (0, "i"): [1], (0, "t"): [1], (0, "j"): [1], (0, "c"): [1], (0, "s"): [1], (0, "w"): [1], (0, "r"): [1], (0, "h"): [1], (0, "n"): [1], (0, "e"): [1], (0, "a"): [1], (0, "f"): [1], (0, "l"): [1], (0, "z"): [1], (0, "b"): [1], (0, "y"): [1], (0, "v"): [1], (0, "m"): [1], (0, "q"): [1], (0, "x"): [1], (0, "p"): [1], (1, "G"): [1], (1, "A"): [1], (1, "Z"): [1], (1, "3"): [1], (1, "C"): [1], (1, "d"): [1], (1, "k"): [1], (1, "9"): [1], (1, "o"): [1], (1, "H"): [1], (1, "1"): [1], (1, "g"): [1], (1, "u"): [1], (1, "B"): [1], (1, "7"): [1], (1, "i"): [1], (1, "t"): [1], (1, "4"): [1], (1, "N"): [1], (1, "j"): [1], (1, "c"): [1], (1, "s"): [1], (1, "J"): [1], (1, "O"): [1], (1, "w"): [1], (1, "Y"): [1], (1, "R"): [1], (1, "2"): [1], (1, "r"): [1], (1, "L"): [1], (1, "h"): [1], (1, "n"): [1], (1, "e"): [1], (1, "M"): [1], (1, "S"): [1], (1, "V"): [1], (1, "a"): [1], (1, "W"): [1], (1, "0"): [1], (1, "8"): [1], (1, "K"): [1], (1, "P"): [1], (1, "6"): [1], (1, "U"): [1], (1, "F"): [1], (1, "f"): [1], (1, "X"): [1], (1, "l"): [1], (1, "z"): [1], (1, "T"): [1], (1, "E"): [1], (1, "5"): [1], (1, "I"): [1], (1, "Q"): [1], (1, "D"): [1], (1, "b"): [1], (1, "y"): [1], (1, "v"): [1], (1, "m"): [1], (1, "q"): [1], (1, "x"): [1], (1, "p"): [1], }, start=0)),
            (G["string"], NFA(3, [0], {(1, "\""): [2], (2, "G"): [2], (2, "Z"): [2], (2, "]"): [2], (2, "o"): [2], (2, "~"): [2], (2, "<"): [2], (2, "+"): [2], (2, "s"): [2], (2, "O"): [2], (2, "R"): [2], (2, "L"): [2], (2, "K"): [2], (2, " "): [2], (2, "&"): [2], (2, "`"): [2], (2, "X"): [2], (2, "T"): [2], (2, "-"): [2], (2, "b"): [2], (2, "}"): [2], (2, "'"): [2], (2, "d"): [2], (2, ";"): [2], (2, "u"): [2], (2, "_"): [2], (2, "\\"): [2], (2, "4"): [2], (2, "%"): [2], (2, "N"): [2], (2, "J"): [2], (2, "c"): [2], (2, "*"): [2], (2, "2"): [2], (2, ","): [2], (2, "n"): [2], (2, "/"): [2], (2, "5"): [2], (2, "Q"): [2], (2, "D"): [2], (2, "$"): [2], (2, "y"): [2], (2, "v"): [2], (2, "m"): [2], (2, "q"): [2], (2, "x"): [2], (2, "{"): [2], (2, "W"): [2], (2, "3"): [2], (2, "k"): [2], (2, "1"): [2], (2, "H"): [2], (2, "i"): [2], (2, "t"): [2], (2, "Y"): [2], (2, "w"): [2], (2, "M"): [2], (2, "h"): [2], (2, "("): [2], (2, "a"): [2], (2, "|"): [2], (2, "0"): [2], (2, "8"): [2], (2, ":"): [2], (2, "^"): [2], (2, "6"): [2], (2, "U"): [2], (2, "F"): [2], (2, "l"): [2], (2, "E"): [2], (2, "I"): [2], (2, "="): [2], (2, ">"): [2], (2, "A"): [2], (2, "C"): [2], (2, "9"): [2], (2, "g"): [2], (2, "B"): [2], (2, "7"): [2], (2, "j"): [2], (2, "!"): [2], (2, "#"): [2], (2, "@"): [2], (2, "r"): [2], (2, "["): [2], (2, "."): [2], (2, "S"): [2], (2, "V"): [2], (2, "e"): [2], (2, "?"): [2], (2, "P"): [2], (2, "f"): [2], (2, "z"): [2], (2, "\""): [0], (2, "p"): [2], (2, ")"): [2], (0, "G"): [2], (0, "Z"): [2], (0, "]"): [2], (0, "o"): [2], (0, "~"): [2], (0, "<"): [2], (0, "+"): [2], (0, "s"): [2], (0, "O"): [2], (0, "R"): [2], (0, "L"): [2], (0, "K"): [2], (0, " "): [2], (0, "&"): [2], (0, "`"): [2], (0, "X"): [2], (0, "T"): [2], (0, "-"): [2], (0, "b"): [2], (0, "}"): [2], (0, "'"): [2], (0, "d"): [2], (0, ";"): [2], (0, "u"): [2], (0, "_"): [2], (0, "\\"): [2], (0, "4"): [2], (0, "%"): [2], (0, "N"): [2], (0, "J"): [2], (0, "c"): [2], (0, "*"): [2], (0, "2"): [2], (0, ","): [2], (0, "n"): [2], (0, "/"): [2], (0, "5"): [2], (0, "Q"): [2], (0, "D"): [2], (0, "$"): [2], (0, "y"): [2], (0, "v"): [2], (0, "m"): [2], (0, "q"): [2], (0, "x"): [2], (0, "{"): [2], (0, "W"): [2], (0, "3"): [2], (0, "k"): [2], (0, "1"): [2], (0, "H"): [2], (0, "i"): [2], (0, "t"): [2], (0, "Y"): [2], (0, "w"): [2], (0, "M"): [2], (0, "h"): [2], (0, "("): [2], (0, "a"): [2], (0, "|"): [2], (0, "0"): [2], (0, "8"): [2], (0, ":"): [2], (0, "^"): [2], (0, "6"): [2], (0, "U"): [2], (0, "F"): [2], (0, "l"): [2], (0, "E"): [2], (0, "I"): [2], (0, "="): [2], (0, ">"): [2], (0, "A"): [2], (0, "C"): [2], (0, "9"): [2], (0, "g"): [2], (0, "B"): [2], (0, "7"): [2], (0, "j"): [2], (0, "!"): [2], (0, "#"): [2], (0, "@"): [2], (0, "r"): [2], (0, "["): [2], (0, "."): [2], (0, "S"): [2], (0, "V"): [2], (0, "e"): [2], (0, "?"): [2], (0, "P"): [2], (0, "f"): [2], (0, "z"): [2], (0, "\""): [0], (0, "p"): [2], (0, ")"): [2], }, start=1)),
        ]

    def _build_regexs(self, table):
        regexs = []
        for n, (token_type, nfa) in enumerate(self.__table()):
            automaton, states = State.from_nfa(nfa, get_states=True)

            for state in states:
                if state.final:
                    state.tag = (n, token_type)

            regexs.append(automaton)

        return regexs
